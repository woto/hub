<% content_for :title do %>
  <%= t(@settings[:plural], scope: ['titles']) %>
<% end %>

<%= render 'breadcrumbs' %>

<div class="col-12">
  <%= render 'admin' rescue nil %>
  <%# render 'filters', klass: FeedFilterForm, model: Feed %>

  <% if params[:dcf] %>
    <%= render 'columns_form'  %>
  <% end %>

  <% if params[:dwf] %>
    <%= render 'workspace_form'  %>
  <% end %>

  <div class="card">
    <div class="card-body p-0">
      <%= render 'table_header', rows: rows %>
      <div class="table-responsive">
        <table class="table card-table table-vcenter text-nowrap datatable table-striped">
          <thead>
            <tr>
              <% if params[:controller] != 'tables/favorites' %>
                <%= render TableComponent::HeaderComponent.new col_name: GlobalHelper::FAVORITE_COLUMN,
                                                               settings: @settings
                %>
              <% end %>
              <% @settings[:form_class].parsed_columns_for(request, current_user && current_user.role).each do |col_name| %>
                <%= render TableComponent::HeaderComponent.new col_name: col_name,
                                                               settings: @settings
                %>
              <% end %>
              <% if policy(@settings[:model_class]).new? %>
                <th>
                </th>
              <% end %>
            </tr>
          </thead>
          <tbody>
          <% rows.each do |row| %>
              <%= tag.tr id: "table_#{@settings[:singular]}_#{row.id}", class: "table_#{@settings[:singular]}" do %>
                <% if params[:controller] != 'tables/favorites' %>
                  <td>
                    <%= render FavoriteComponent.new(is_favorite: row.is_favorite, ext_id: row.id, kind: @settings[:plural], starred_class: 'text-yellow', unstarred_class: 'text-secondary') %>
                  </td>
                <% end %>
                <% @settings[:form_class].parsed_columns_for(request, current_user && current_user.role).each do |col_name| %>
                  <td>
                    <%# TODO! add decorators %>
                    <%= row.public_send(col_name) %>
                    <%#= public_send("_#{col_name}", row[col_name]) %>
                  </td>
                <% end %>
                <% if policy(@settings[:model_class]).new? %>
                  <td>
                    <%= render 'controls', row: row %>
                    <%= render 'debug', row: row %>
                  </td>
                <% end %>
              <% end %>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
    <%= render 'table_footer', rows: rows %>
  </div>
</div>

<% content_for :left_menu do %>
  <%= render 'workspaces' %>
<% end %>
