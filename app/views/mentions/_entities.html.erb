<%= tag.div class: 'mb-3' do %>

  <%# TODO: write article %>
  <%= hidden_field_tag 'mention[related_entities][foo][id]', nil, form: f.options[:html][:id] %>

  <%#= f.input :related_entities, label: false, error: false do %>
    <% f.object.entities_mentions.each do |entity_mention| %>
      <%= render Entities::CardComponent.new(
        entity_id: entity_mention.entity.id,
        is_main: entity_mention.is_main,
        image: entity_mention.entity.image_hash,
        title: entity_mention.entity.title,
        intro: entity_mention.entity.intro,
        lookups: entity_mention.entity.lookups.map(&:to_label),
        topics: entity_mention.entity.topics.map(&:to_label),
        controllable: true,
        assignable: false,
        form_id: f.options[:html][:id]
      ) %>
    <% end %>
  <%# end %>

  <%= tag.div 'data-controller': 'mention-new-entity' do %>

    <%= tag.div 'data-mention-new-entity-target': 'cardPlaceholder' %>

    <%= tag.a href: '#',
              class: 'btn btn-success',
              'data-action': 'mention-new-entity#openModal',
              'data-mention-new-entity-url-param': assign_mentions_entities_path(form_id: f.options[:html][:id]) do %>
      <%= t('.add_entity') %>
    <% end %>

    <%= tag.div 'data-mention-new-entity-target': 'modalPlaceholder' %>

  <% end %>

  <%= f.full_error :entities_mentions, class: 'invalid-feedback d-block' %>

<% end %>
