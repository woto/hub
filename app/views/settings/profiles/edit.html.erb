<% content_for :title do %>
  <%= t("titles.settings") %>
<% end %>

<% content_for :breadcrumbs do %>
  <li class="breadcrumb-item">
    <%= link_to t('breadcrumbs.homepage'), root_path %>
  </li>
  <li class="breadcrumb-item">
    <%= link_to t('breadcrumbs.dashboard'), dashboard_path %>
  </li>
  <li class="breadcrumb-item active">
    <%=link_to t('breadcrumbs.profile'), edit_settings_profile_path %>
  </li>
<% end %>

<div class="col">
<div class="card card-md">

  <div class="card-body">

    <div class="row">

      <div class="col-md-3">
        <%= render ProfileListComponent.new %>
      </div>

      <div class="col-md-9 col-xl-8">

        <%= render InpageTitleComponent.new(
            title: t("profile edit")
        ) %>

        <div class="row">

          <div class="col col-12 col-sm-3 col-md-4 order-sm-last mb-3 d-flex justify-content-center">

            <div>
              <label class="string required" for="resource_name_location">Avatar</label>
              <%= tag.div data: {controller: 'profile-avatar'}, id: "avatar-clickable" do %>
                <%= form_tag settings_avatar_path,
                             class: 'dropzone d-flex align-items-center justify-content-center h-100 p-2',
                             data: {target: 'profile-avatar.dropzoneComponent'} do %>
                  <div class="dz-message">
                    <% if current_user.avatar.attached? %>
                      <%= image_tag current_user.avatar.variant(resize_to_limit: [200, 200])  %>
                    <% else %>
                      <%= t('drop_image_here_or_click') %>
                    <% end %>
                  </div>
                <% end %>
              <% end %>
            </div>
          </div>

          <div class="col col-sm-9 col-md-8">

            <%= simple_form_for @profile_form, url: settings_profile_path, html: {method: :put}, local: true do |f| %>

              <%= f.error_notification %>

              <%= f.input :name,
                          required: true,
                          input_html: {autocomplete: "name"},
                          wrapper_html: {class: 'mb-3'}
              %>

              <%= f.input :bio,
                          required: true,
                          input_html: {rows: 4},
                          wrapper_html: {class: 'mb-3'},
                          as: :text
              %>

              <%= f.input :time_zone,
                          required: true,
                          wrapper_html: {class: 'mb-3'},
                          input_html: {class: "form-select"},
                          as: :time_zone
              %>

              <%= f.input :messengers,
                          as: 'profile/messengers_collection',
                          wrapper_html: {class: 'mb-3'}
              %>

              <%= f.input :languages,
                          required: true,
                          input_html: {data: {controller: 'profile-language'}, multiple: true},
                          wrapper_html: {class: 'mb-3'},
                          as: :select,
                          collection: Rails.application.config.global[:languages].map { |lng| [lng[:language], lng[:english_name]] }

              %>

              <div class="form-footer">
                <%= f.button :submit, t(".update"), class: 'btn btn-primary' %>
              </div>

            <% end %>

          </div>

        </div>

      </div>
    </div>
  </div>
</div>
</div>
